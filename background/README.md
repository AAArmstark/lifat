### To create/update a background image gallery:
* First arrange the image files in [`public/images/background/gallery`](https://github.com/schlawg/lila/tree/bg-image-gallery/public/images/background/gallery). The alphanumeric sort order of the filenames will become the gallery order. 
* Then run [`bin/make-gallery`](https://github.com/schlawg/lila/blob/bg-image-gallery/bin/make-gallery).
* That script uses imagemagick to build `columns-2.webp` and `columns-4.webp`. These generated images are a montage of thumbnails rendered at 160x90 each in 2 & 4 column grids.
* It also spits out a [`gallery.json`](https://github.com/schlawg/lila/blob/bg-image-gallery/public/images/background/gallery.json) which is an ordered array of image asset URLs corresponding to gallery position.
### At runtime:
* When lila starts, it [parses `gallery.json` once](https://github.com/schlawg/lila/blob/03f244cc0a1215799494024f978c1ae8214f23d3/app/controllers/Dasher.scala#L55) and includes that array in all [dasher responses](https://github.com/schlawg/lila/blob/03f244cc0a1215799494024f978c1ae8214f23d3/app/controllers/Dasher.scala#L88). The gallery.json could also be fetched by each client's dasher module, but that's a lot of redundant requests.
* The client [delegates to old behavior](https://github.com/schlawg/lila/blob/03f244cc0a1215799494024f978c1ae8214f23d3/ui/dasher/src/background.ts#L102) if there's no gallery in the dasher params.
* If there is a gallery image array, the client  [constructs a URL](https://github.com/schlawg/lila/blob/03f244cc0a1215799494024f978c1ae8214f23d3/ui/dasher/src/background.ts#L189) to the right thumbnail background. Both 2 column and 4 column versions are around 1 kilobyte per thumbnail rendered at 160x90px. So fetching an entire gallery of 28 images results in a single fetch of a single 28kb image, and that is lazily done when they click Transparent. No serverside processing or resizing is required.
* The client then [creates a 2 or 4 column grid of divs](https://github.com/schlawg/lila/blob/03f244cc0a1215799494024f978c1ae8214f23d3/ui/dasher/src/background.ts#L201) that lighten their slice of the parent's gallery grid background image on hover. The divs also handle clicks and outline current selection.
